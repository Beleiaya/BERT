WARNING:tensorflow:From /home/htxu91/source/BERT/t2t_bert/optimizer/optimizer_utils.py:9: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

WARNING:tensorflow:From /home/htxu91/source/BERT/t2t_bert/distributed_encoder/gpt_encoder.py:6: The name tf.AUTO_REUSE is deprecated. Please use tf.compat.v1.AUTO_REUSE instead.

WARNING:tensorflow:
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

WARNING:tensorflow:From /home/htxu91/source/BERT/t2t_bert/model_io/model_io_utils.py:14: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

WARNING:tensorflow:From ./t2t_bert/distributed_bin/tpu_train_eval_api.py:342: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

I1030 05:38:34.122971 140639267308992 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1/rest
I1030 05:38:34.164803 140639267308992 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1/projects/albert-tpu-pretrain/locations/us-central1-a/nodes/htxu91?alt=json
I1030 05:38:34.165055 140639267308992 transport.py:157] Attempting refresh to obtain initial access_token
I1030 05:38:34.214345 140639267308992 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1/rest
I1030 05:38:34.251734 140639267308992 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1/projects/albert-tpu-pretrain/locations/us-central1-a/nodes/htxu91?alt=json
I1030 05:38:34.251981 140639267308992 transport.py:157] Attempting refresh to obtain initial access_token
WARNING:tensorflow:From /home/htxu91/source/BERT/t2t_bert/pretrain_finetuning/train_eval_tpu_estimator.py:55: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

W1030 05:38:34.300704 140639267308992 module_wrapper.py:139] From /home/htxu91/source/BERT/t2t_bert/pretrain_finetuning/train_eval_tpu_estimator.py:55: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

INFO:tensorflow:***** Running evaluation *****
I1030 05:38:34.300937 140639267308992 train_eval_tpu_estimator.py:55] ***** Running evaluation *****
INFO:tensorflow:***** train steps : 585900
I1030 05:38:34.301032 140639267308992 train_eval_tpu_estimator.py:56] ***** train steps : 585900
WARNING:tensorflow:Estimator's model_fn (<function model_fn at 0x7fe8c5805050>) includes params argument, but params are not passed to Estimator.
W1030 05:38:34.301630 140639267308992 estimator.py:1994] Estimator's model_fn (<function model_fn at 0x7fe8c5805050>) includes params argument, but params are not passed to Estimator.
INFO:tensorflow:Using config: {'_save_checkpoints_secs': None, '_session_config': allow_soft_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
isolate_session_state: true
, '_keep_checkpoint_max': 20, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fe8d5c85790>, '_model_dir': 'gs://yyht_source/pretrain/model/albert_tiny_factorized', '_protocol': None, '_save_checkpoints_steps': 1000, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=1000, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=3, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2, experimental_host_call_every_n_steps=1), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_session_creation_timeout_secs': 7200, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fe8c5882c10>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I1030 05:38:34.304256 140639267308992 estimator.py:212] Using config: {'_save_checkpoints_secs': None, '_session_config': allow_soft_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
isolate_session_state: true
, '_keep_checkpoint_max': 20, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fe8d5c85790>, '_model_dir': 'gs://yyht_source/pretrain/model/albert_tiny_factorized', '_protocol': None, '_save_checkpoints_steps': 1000, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=1000, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=3, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2, experimental_host_call_every_n_steps=1), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_session_creation_timeout_secs': 7200, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fe8c5882c10>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
INFO:tensorflow:_TPUContext: eval_on_tpu True
I1030 05:38:34.304502 140639267308992 tpu_context.py:220] _TPUContext: eval_on_tpu True
INFO:tensorflow:***** Running training *****
I1030 05:38:34.304869 140639267308992 train_eval_tpu_estimator.py:100] ***** Running training *****
INFO:tensorflow:  Batch size = 1024
I1030 05:38:34.304944 140639267308992 train_eval_tpu_estimator.py:101]   Batch size = 1024
INFO:tensorflow:Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
I1030 05:38:35.089220 140639267308992 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-10-30 05:38:35.090632: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:370] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
INFO:tensorflow:Found TPU system:
I1030 05:38:35.102490 140639267308992 tpu_system_metadata.py:148] Found TPU system:
INFO:tensorflow:*** Num TPU Cores: 8
I1030 05:38:35.102730 140639267308992 tpu_system_metadata.py:149] *** Num TPU Cores: 8
INFO:tensorflow:*** Num TPU Workers: 1
I1030 05:38:35.102818 140639267308992 tpu_system_metadata.py:150] *** Num TPU Workers: 1
INFO:tensorflow:*** Num TPU Cores Per Worker: 8
I1030 05:38:35.102884 140639267308992 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
INFO:tensorflow:*** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 1639531074327569543)
I1030 05:38:35.102946 140639267308992 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 1639531074327569543)
INFO:tensorflow:*** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 41494689581269216)
I1030 05:38:35.103385 140639267308992 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 41494689581269216)
INFO:tensorflow:*** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7095869018195602430)
I1030 05:38:35.103457 140639267308992 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 7095869018195602430)
INFO:tensorflow:*** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 15250659079423088523)
I1030 05:38:35.103583 140639267308992 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 15250659079423088523)
INFO:tensorflow:*** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 15644193766071235452)
I1030 05:38:35.103653 140639267308992 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 15644193766071235452)
INFO:tensorflow:*** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4662234986458389774)
I1030 05:38:35.103715 140639267308992 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 4662234986458389774)
INFO:tensorflow:*** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15670119308569260877)
I1030 05:38:35.103779 140639267308992 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 15670119308569260877)
INFO:tensorflow:*** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 5489878825695879247)
I1030 05:38:35.103842 140639267308992 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 5489878825695879247)
INFO:tensorflow:*** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 7489019433735477811)
I1030 05:38:35.103904 140639267308992 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 7489019433735477811)
INFO:tensorflow:*** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 6385825173283561049)
I1030 05:38:35.103964 140639267308992 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 6385825173283561049)
INFO:tensorflow:*** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 17307258328290596654)
I1030 05:38:35.104026 140639267308992 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 17307258328290596654)
WARNING:tensorflow:From /usr/local/lib/python2.7/dist-packages/tensorflow_core/python/ops/resource_variable_ops.py:1630: calling __init__ (from tensorflow.python.ops.resource_variable_ops) with constraint is deprecated and will be removed in a future version.
Instructions for updating:
If using Keras pass *_constraint arguments to layers.
W1030 05:38:35.110317 140639267308992 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow_core/python/ops/resource_variable_ops.py:1630: calling __init__ (from tensorflow.python.ops.resource_variable_ops) with constraint is deprecated and will be removed in a future version.
Instructions for updating:
If using Keras pass *_constraint arguments to layers.
WARNING:tensorflow:From /usr/local/lib/python2.7/dist-packages/tensorflow_core/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
W1030 05:38:35.110804 140639267308992 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_core/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
INFO:tensorflow:Calling model_fn.
I1030 05:38:35.121767 140639267308992 estimator.py:1148] Calling model_fn.
WARNING:tensorflow:From /home/htxu91/source/BERT/t2t_bert/data_generator/tf_data_utils.py:140: The name tf.FixedLenFeature is deprecated. Please use tf.io.FixedLenFeature instead.

W1030 05:38:35.122512 140639267308992 module_wrapper.py:139] From /home/htxu91/source/BERT/t2t_bert/data_generator/tf_data_utils.py:140: The name tf.FixedLenFeature is deprecated. Please use tf.io.FixedLenFeature instead.

WARNING:tensorflow:From /home/htxu91/source/BERT/t2t_bert/data_generator/tf_data_utils.py:171: parallel_interleave (from tensorflow.contrib.data.python.ops.interleave_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.data.experimental.parallel_interleave(...)`.
W1030 05:38:35.127998 140639267308992 deprecation.py:323] From /home/htxu91/source/BERT/t2t_bert/data_generator/tf_data_utils.py:171: parallel_interleave (from tensorflow.contrib.data.python.ops.interleave_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.data.experimental.parallel_interleave(...)`.
WARNING:tensorflow:From /usr/local/lib/python2.7/dist-packages/tensorflow_core/contrib/data/python/ops/interleave_ops.py:77: parallel_interleave (from tensorflow.python.data.experimental.ops.interleave_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.data.Dataset.interleave(map_func, cycle_length, block_length, num_parallel_calls=tf.data.experimental.AUTOTUNE)` instead. If sloppy execution is desired, use `tf.data.Options.experimental_determinstic`.
W1030 05:38:35.128181 140639267308992 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_core/contrib/data/python/ops/interleave_ops.py:77: parallel_interleave (from tensorflow.python.data.experimental.ops.interleave_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.data.Dataset.interleave(map_func, cycle_length, block_length, num_parallel_calls=tf.data.experimental.AUTOTUNE)` instead. If sloppy execution is desired, use `tf.data.Options.experimental_determinstic`.
WARNING:tensorflow:From /home/htxu91/source/BERT/t2t_bert/data_generator/tf_data_utils.py:188: map_and_batch (from tensorflow.contrib.data.python.ops.batching) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.data.experimental.map_and_batch(...)`.
W1030 05:38:35.154087 140639267308992 deprecation.py:323] From /home/htxu91/source/BERT/t2t_bert/data_generator/tf_data_utils.py:188: map_and_batch (from tensorflow.contrib.data.python.ops.batching) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.data.experimental.map_and_batch(...)`.
WARNING:tensorflow:From /usr/local/lib/python2.7/dist-packages/tensorflow_core/contrib/data/python/ops/batching.py:276: map_and_batch (from tensorflow.python.data.experimental.ops.batching) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.data.Dataset.map(map_func, num_parallel_calls)` followed by `tf.data.Dataset.batch(batch_size, drop_remainder)`. Static tf.data optimizations will take care of using the fused implementation.
W1030 05:38:35.154330 140639267308992 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_core/contrib/data/python/ops/batching.py:276: map_and_batch (from tensorflow.python.data.experimental.ops.batching) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.data.Dataset.map(map_func, num_parallel_calls)` followed by `tf.data.Dataset.batch(batch_size, drop_remainder)`. Static tf.data optimizations will take care of using the fused implementation.
WARNING:tensorflow:From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/api/_v1/estimator/__init__.py:12: The name tf.estimator.inputs is deprecated. Please use tf.compat.v1.estimator.inputs instead.

W1030 05:38:35.160130 140639267308992 module_wrapper.py:139] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/api/_v1/estimator/__init__.py:12: The name tf.estimator.inputs is deprecated. Please use tf.compat.v1.estimator.inputs instead.

WARNING:tensorflow:From /usr/local/lib/python2.7/dist-packages/tensorflow_core/python/autograph/converters/directives.py:119: The name tf.parse_single_example is deprecated. Please use tf.io.parse_single_example instead.

W1030 05:38:35.218780 140639267308992 module_wrapper.py:139] From /usr/local/lib/python2.7/dist-packages/tensorflow_core/python/autograph/converters/directives.py:119: The name tf.parse_single_example is deprecated. Please use tf.io.parse_single_example instead.

WARNING:tensorflow:From /home/htxu91/source/BERT/t2t_bert/data_generator/tf_data_utils.py:43: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W1030 05:38:35.333833 140639267308992 deprecation.py:323] From /home/htxu91/source/BERT/t2t_bert/data_generator/tf_data_utils.py:43: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
2019-10-30 05:38:35.392907: W tensorflow/stream_executor/platform/default/dso_loader.cc:55] Could not load dynamic library 'libcuda.so.1'; dlerror: libcuda.so.1: cannot open shared object file: No such file or directory
2019-10-30 05:38:35.392956: E tensorflow/stream_executor/cuda/cuda_driver.cc:318] failed call to cuInit: UNKNOWN ERROR (303)
2019-10-30 05:38:35.392984: I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:156] kernel driver does not appear to be running on this host (htxu91): /proc/driver/nvidia/version does not exist
INFO:tensorflow: begin to build bert
I1030 05:38:35.410569 140639267308992 albert.py:14]  begin to build bert
WARNING:tensorflow:From /home/htxu91/source/BERT/t2t_bert/model/bert/albert.py:22: The name tf.variable_scope is deprecated. Please use tf.compat.v1.variable_scope instead.

W1030 05:38:35.410861 140639267308992 module_wrapper.py:139] From /home/htxu91/source/BERT/t2t_bert/model/bert/albert.py:22: The name tf.variable_scope is deprecated. Please use tf.compat.v1.variable_scope instead.

WARNING:tensorflow:From /home/htxu91/source/BERT/t2t_bert/utils/bert/albert_modules.py:193: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

W1030 05:38:35.412671 140639267308992 module_wrapper.py:139] From /home/htxu91/source/BERT/t2t_bert/utils/bert/albert_modules.py:193: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

WARNING:tensorflow:From /home/htxu91/source/BERT/t2t_bert/utils/bert/albert_modules.py:89: calling dropout (from tensorflow.python.ops.nn_ops) with keep_prob is deprecated and will be removed in a future version.
Instructions for updating:
Please use `rate` instead of `keep_prob`. Rate should be set to `rate = 1 - keep_prob`.
W1030 05:38:35.479671 140639267308992 deprecation.py:506] From /home/htxu91/source/BERT/t2t_bert/utils/bert/albert_modules.py:89: calling dropout (from tensorflow.python.ops.nn_ops) with keep_prob is deprecated and will be removed in a future version.
Instructions for updating:
Please use `rate` instead of `keep_prob`. Rate should be set to `rate = 1 - keep_prob`.
WARNING:tensorflow:From /home/htxu91/source/BERT/t2t_bert/utils/bert/albert_modules.py:613: dense (from tensorflow.python.layers.core) is deprecated and will be removed in a future version.
Instructions for updating:
Use keras.layers.Dense instead.
W1030 05:38:35.498179 140639267308992 deprecation.py:323] From /home/htxu91/source/BERT/t2t_bert/utils/bert/albert_modules.py:613: dense (from tensorflow.python.layers.core) is deprecated and will be removed in a future version.
Instructions for updating:
Use keras.layers.Dense instead.
WARNING:tensorflow:From /usr/local/lib/python2.7/dist-packages/tensorflow_core/python/layers/core.py:187: apply (from tensorflow.python.keras.engine.base_layer) is deprecated and will be removed in a future version.
Instructions for updating:
Please use `layer.__call__` method instead.
W1030 05:38:35.499469 140639267308992 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_core/python/layers/core.py:187: apply (from tensorflow.python.keras.engine.base_layer) is deprecated and will be removed in a future version.
Instructions for updating:
Please use `layer.__call__` method instead.
WARNING:tensorflow:From /home/htxu91/source/BERT/t2t_bert/utils/bert/albert_modules.py:30: The name tf.erf is deprecated. Please use tf.math.erf instead.

W1030 05:38:35.639854 140639267308992 module_wrapper.py:139] From /home/htxu91/source/BERT/t2t_bert/utils/bert/albert_modules.py:30: The name tf.erf is deprecated. Please use tf.math.erf instead.

WARNING:tensorflow:From /home/htxu91/source/BERT/t2t_bert/model_io/model_io_utils.py:99: The name tf.get_collection is deprecated. Please use tf.compat.v1.get_collection instead.

W1030 05:38:36.263447 140639267308992 module_wrapper.py:139] From /home/htxu91/source/BERT/t2t_bert/model_io/model_io_utils.py:99: The name tf.get_collection is deprecated. Please use tf.compat.v1.get_collection instead.

WARNING:tensorflow:From /home/htxu91/source/BERT/t2t_bert/model_io/model_io_utils.py:99: The name tf.GraphKeys is deprecated. Please use tf.compat.v1.GraphKeys instead.

W1030 05:38:36.263736 140639267308992 module_wrapper.py:139] From /home/htxu91/source/BERT/t2t_bert/model_io/model_io_utils.py:99: The name tf.GraphKeys is deprecated. Please use tf.compat.v1.GraphKeys instead.

WARNING:tensorflow:From /home/htxu91/source/BERT/t2t_bert/optimizer/optimizer.py:18: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

W1030 05:38:36.264121 140639267308992 module_wrapper.py:139] From /home/htxu91/source/BERT/t2t_bert/optimizer/optimizer.py:18: The name tf.train.get_or_create_global_step is deprecated. Please use tf.compat.v1.train.get_or_create_global_step instead.

INFO:tensorflow: name = bert/embeddings/word_embeddings:0, shape = (21128, 128), trainable params
I1030 05:38:36.275950 140639267308992 model_io_utils.py:83]  name = bert/embeddings/word_embeddings:0, shape = (21128, 128), trainable params
INFO:tensorflow: name = bert/embeddings/word_embeddings_2:0, shape = (128, 312), trainable params
I1030 05:38:36.276197 140639267308992 model_io_utils.py:83]  name = bert/embeddings/word_embeddings_2:0, shape = (128, 312), trainable params
INFO:tensorflow: name = bert/embeddings/token_type_embeddings:0, shape = (2, 312), trainable params
I1030 05:38:36.276284 140639267308992 model_io_utils.py:83]  name = bert/embeddings/token_type_embeddings:0, shape = (2, 312), trainable params
INFO:tensorflow: name = bert/embeddings/position_embeddings:0, shape = (512, 312), trainable params
I1030 05:38:36.276361 140639267308992 model_io_utils.py:83]  name = bert/embeddings/position_embeddings:0, shape = (512, 312), trainable params
INFO:tensorflow: name = bert/embeddings/LayerNorm/beta:0, shape = (312,), trainable params
I1030 05:38:36.276436 140639267308992 model_io_utils.py:83]  name = bert/embeddings/LayerNorm/beta:0, shape = (312,), trainable params
INFO:tensorflow: name = bert/embeddings/LayerNorm/gamma:0, shape = (312,), trainable params
I1030 05:38:36.276518 140639267308992 model_io_utils.py:83]  name = bert/embeddings/LayerNorm/gamma:0, shape = (312,), trainable params
INFO:tensorflow: name = bert/encoder/layer_shared/attention/self/query/kernel:0, shape = (312, 312), trainable params
I1030 05:38:36.276583 140639267308992 model_io_utils.py:83]  name = bert/encoder/layer_shared/attention/self/query/kernel:0, shape = (312, 312), trainable params
INFO:tensorflow: name = bert/encoder/layer_shared/attention/self/query/bias:0, shape = (312,), trainable params
I1030 05:38:36.276658 140639267308992 model_io_utils.py:83]  name = bert/encoder/layer_shared/attention/self/query/bias:0, shape = (312,), trainable params
INFO:tensorflow: name = bert/encoder/layer_shared/attention/self/key/kernel:0, shape = (312, 312), trainable params
I1030 05:38:36.276736 140639267308992 model_io_utils.py:83]  name = bert/encoder/layer_shared/attention/self/key/kernel:0, shape = (312, 312), trainable params
INFO:tensorflow: name = bert/encoder/layer_shared/attention/self/key/bias:0, shape = (312,), trainable params
I1030 05:38:36.276807 140639267308992 model_io_utils.py:83]  name = bert/encoder/layer_shared/attention/self/key/bias:0, shape = (312,), trainable params
INFO:tensorflow: name = bert/encoder/layer_shared/attention/self/value/kernel:0, shape = (312, 312), trainable params
I1030 05:38:36.276870 140639267308992 model_io_utils.py:83]  name = bert/encoder/layer_shared/attention/self/value/kernel:0, shape = (312, 312), trainable params
INFO:tensorflow: name = bert/encoder/layer_shared/attention/self/value/bias:0, shape = (312,), trainable params
I1030 05:38:36.276940 140639267308992 model_io_utils.py:83]  name = bert/encoder/layer_shared/attention/self/value/bias:0, shape = (312,), trainable params
INFO:tensorflow: name = bert/encoder/layer_shared/attention/output/dense/kernel:0, shape = (312, 312), trainable params
I1030 05:38:36.277004 140639267308992 model_io_utils.py:83]  name = bert/encoder/layer_shared/attention/output/dense/kernel:0, shape = (312, 312), trainable params
INFO:tensorflow: name = bert/encoder/layer_shared/attention/output/dense/bias:0, shape = (312,), trainable params
I1030 05:38:36.277080 140639267308992 model_io_utils.py:83]  name = bert/encoder/layer_shared/attention/output/dense/bias:0, shape = (312,), trainable params
INFO:tensorflow: name = bert/encoder/layer_shared/attention/output/LayerNorm/beta:0, shape = (312,), trainable params
I1030 05:38:36.277144 140639267308992 model_io_utils.py:83]  name = bert/encoder/layer_shared/attention/output/LayerNorm/beta:0, shape = (312,), trainable params
INFO:tensorflow: name = bert/encoder/layer_shared/attention/output/LayerNorm/gamma:0, shape = (312,), trainable params
I1030 05:38:36.277209 140639267308992 model_io_utils.py:83]  name = bert/encoder/layer_shared/attention/output/LayerNorm/gamma:0, shape = (312,), trainable params
INFO:tensorflow: name = bert/encoder/layer_shared/intermediate/dense/kernel:0, shape = (312, 1200), trainable params
I1030 05:38:36.277272 140639267308992 model_io_utils.py:83]  name = bert/encoder/layer_shared/intermediate/dense/kernel:0, shape = (312, 1200), trainable params
INFO:tensorflow: name = bert/encoder/layer_shared/intermediate/dense/bias:0, shape = (1200,), trainable params
I1030 05:38:36.277362 140639267308992 model_io_utils.py:83]  name = bert/encoder/layer_shared/intermediate/dense/bias:0, shape = (1200,), trainable params
INFO:tensorflow: name = bert/encoder/layer_shared/output/dense/kernel:0, shape = (1200, 312), trainable params
I1030 05:38:36.277426 140639267308992 model_io_utils.py:83]  name = bert/encoder/layer_shared/output/dense/kernel:0, shape = (1200, 312), trainable params
INFO:tensorflow: name = bert/encoder/layer_shared/output/dense/bias:0, shape = (312,), trainable params
I1030 05:38:36.277503 140639267308992 model_io_utils.py:83]  name = bert/encoder/layer_shared/output/dense/bias:0, shape = (312,), trainable params
INFO:tensorflow: name = bert/encoder/layer_shared/output/LayerNorm/beta:0, shape = (312,), trainable params
I1030 05:38:36.277570 140639267308992 model_io_utils.py:83]  name = bert/encoder/layer_shared/output/LayerNorm/beta:0, shape = (312,), trainable params
INFO:tensorflow: name = bert/encoder/layer_shared/output/LayerNorm/gamma:0, shape = (312,), trainable params
I1030 05:38:36.277633 140639267308992 model_io_utils.py:83]  name = bert/encoder/layer_shared/output/LayerNorm/gamma:0, shape = (312,), trainable params
INFO:tensorflow: name = bert/pooler/dense/kernel:0, shape = (312, 312), trainable params
I1030 05:38:36.277698 140639267308992 model_io_utils.py:83]  name = bert/pooler/dense/kernel:0, shape = (312, 312), trainable params
INFO:tensorflow: name = bert/pooler/dense/bias:0, shape = (312,), trainable params
I1030 05:38:36.277766 140639267308992 model_io_utils.py:83]  name = bert/pooler/dense/bias:0, shape = (312,), trainable params
INFO:tensorflow: name = cls/predictions/transform/dense/kernel:0, shape = (312, 312), trainable params
I1030 05:38:36.277838 140639267308992 model_io_utils.py:83]  name = cls/predictions/transform/dense/kernel:0, shape = (312, 312), trainable params
INFO:tensorflow: name = cls/predictions/transform/dense/bias:0, shape = (312,), trainable params
I1030 05:38:36.277908 140639267308992 model_io_utils.py:83]  name = cls/predictions/transform/dense/bias:0, shape = (312,), trainable params
INFO:tensorflow: name = cls/predictions/transform/LayerNorm/beta:0, shape = (312,), trainable params
I1030 05:38:36.277971 140639267308992 model_io_utils.py:83]  name = cls/predictions/transform/LayerNorm/beta:0, shape = (312,), trainable params
INFO:tensorflow: name = cls/predictions/transform/LayerNorm/gamma:0, shape = (312,), trainable params
I1030 05:38:36.278053 140639267308992 model_io_utils.py:83]  name = cls/predictions/transform/LayerNorm/gamma:0, shape = (312,), trainable params
INFO:tensorflow: name = cls/predictions/output_bias:0, shape = (21128,), trainable params
I1030 05:38:36.278121 140639267308992 model_io_utils.py:83]  name = cls/predictions/output_bias:0, shape = (21128,), trainable params
INFO:tensorflow: lr decay method polynomial_decay
I1030 05:38:36.278253 140639267308992 optimizer.py:31]  lr decay method polynomial_decay
WARNING:tensorflow:From /home/htxu91/source/BERT/t2t_bert/optimizer/optimizer.py:34: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

W1030 05:38:36.279098 140639267308992 module_wrapper.py:139] From /home/htxu91/source/BERT/t2t_bert/optimizer/optimizer.py:34: The name tf.train.polynomial_decay is deprecated. Please use tf.compat.v1.train.polynomial_decay instead.

INFO:tensorflow:training_loop marked as finished
I1030 05:38:37.041511 140639267308992 error_handling.py:101] training_loop marked as finished
('/home/htxu91/source/BERT', '==father path==')
['/home/htxu91/source/BERT/t2t_bert/distributed_bin', '/usr/lib/python2.7', '/usr/lib/python2.7/plat-x86_64-linux-gnu', '/usr/lib/python2.7/lib-tk', '/usr/lib/python2.7/lib-old', '/usr/lib/python2.7/lib-dynload', '/usr/local/lib/python2.7/dist-packages', '/usr/lib/python2.7/dist-packages', '/home/htxu91/source/BERT', '/home/htxu91/source/BERT/t2t_bert']
('gs://yyht_source/pretrain/', ['gs://yyht_source/pretrain/data/chunk_0.tfrecords', 'gs://yyht_source/pretrain/data/chunk_1.tfrecords', 'gs://yyht_source/pretrain/data/chunk_2.tfrecords', 'gs://yyht_source/pretrain/data/chunk_3.tfrecords', 'gs://yyht_source/pretrain/data/chunk_4.tfrecords', 'gs://yyht_source/pretrain/data/chunk_5.tfrecords', 'gs://yyht_source/pretrain/data/chunk_6.tfrecords', 'gs://yyht_source/pretrain/data/chunk_7.tfrecords', 'gs://yyht_source/pretrain/data/chunk_8.tfrecords', 'gs://yyht_source/pretrain/data/chunk_9.tfrecords', 'gs://yyht_source/pretrain/data/chunk_10.tfrecords', 'gs://yyht_source/pretrain/data/chunk_11.tfrecords', 'gs://yyht_source/pretrain/data/chunk_12.tfrecords', 'gs://yyht_source/pretrain/data/chunk_13.tfrecords', 'gs://yyht_source/pretrain/data/chunk_14.tfrecords', 'gs://yyht_source/pretrain/data/chunk_15.tfrecords', 'gs://yyht_source/pretrain/data/chunk_16.tfrecords', 'gs://yyht_source/pretrain/data/chunk_17.tfrecords'], ['gs://yyht_source/pretrain/data/chunk_18.tfrecords', 'gs://yyht_source/pretrain/data/chunk_19.tfrecords'], 'gs://yyht_source/pretrain/model/albert_tiny_factorized')
('###tpu_cluster_resolver:', <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fe8c5882c10>, ';FLAGS.use_tpu:', True, ';FLAGS.tpu_name:', 'htxu91', ';FLAGS.tpu_zone:', None)
albert
({u'type_vocab_size': 2, u'pooler_num_fc_layers': 3, u'embedding_size': 128, u'num_attention_heads': 12, u'num_hidden_layers': 4, u'pooler_size_per_head': 128, u'vocab_size': 21128, u'attention_probs_dropout_prob': 0.1, u'directionality': u'bidi', u'pooler_type': u'first_token_transform', u'initializer_range': 0.02, u'max_position_embeddings': 512, u'embedding': u'factorized', u'hidden_act': u'gelu', u'shared_type': u'all', u'hidden_size': 312, u'intermediate_size': 1200, u'hidden_dropout_prob': 0.1, u'pooler_fc_size': 312, u'pooler_num_attention_heads': 12}, '==model config==')
('==apply bert pretrain==', 0.0001)
('==num warmup steps==', 58590)
 model type albert
(585900, 58590, '=============', 1, '==number of gpus==')
 initializing ModelIO 
embedding_lookup_factorized. factorized embedding parameterization is used.
('===number of hidden layers===', 4)
==apply post layer==
==apply albert masked lm==
(1.0, '==mlm lm_ratio==')
 initializing ModelIO 
('==gpu count==', 1)
Traceback (most recent call last):
  File "./t2t_bert/distributed_bin/tpu_train_eval_api.py", line 342, in <module>
    tf.app.run()
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_core/python/platform/app.py", line 40, in run
    _run(main=main, argv=argv, flags_parser=_parse_flags_tolerate_undef)
  File "/usr/local/lib/python2.7/dist-packages/absl/app.py", line 299, in run
    _run_main(main, args)
  File "/usr/local/lib/python2.7/dist-packages/absl/app.py", line 250, in _run_main
    sys.exit(main(argv))
  File "./t2t_bert/distributed_bin/tpu_train_eval_api.py", line 335, in main
    input_target=FLAGS.input_target)
  File "/home/htxu91/source/BERT/t2t_bert/pretrain_finetuning/train_eval_tpu_estimator.py", line 107, in train_eval_fn
    estimator.train(input_fn=input_features, max_steps=num_train_steps)
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py", line 3030, in train
    saving_listeners=saving_listeners)
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/estimator.py", line 370, in train
    loss = self._train_model(input_fn, hooks, saving_listeners)
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/estimator.py", line 1161, in _train_model
    return self._train_model_default(input_fn, hooks, saving_listeners)
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/estimator.py", line 1191, in _train_model_default
    features, labels, ModeKeys.TRAIN, self.config)
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py", line 2857, in _call_model_fn
    config)
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/estimator.py", line 1149, in _call_model_fn
    model_fn_results = self._model_fn(features=features, **kwargs)
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py", line 3159, in _model_fn
    _train_on_tpu_system(ctx, model_fn_wrapper, dequeue_fn))
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py", line 3604, in _train_on_tpu_system
    device_assignment=ctx.device_assignment)
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_core/python/tpu/tpu.py", line 1277, in split_compile_and_shard
    name=name)
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_core/python/tpu/tpu.py", line 992, in split_compile_and_replicate
    outputs = computation(*computation_inputs)
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py", line 3589, in multi_tpu_train_steps_on_single_shard
    inputs=[0, _INITIAL_LOSS])
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_core/python/tpu/training_loop.py", line 178, in while_loop
    condition_wrapper, body_wrapper, inputs, name="", parallel_iterations=1)
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_core/python/ops/control_flow_ops.py", line 2753, in while_loop
    return_same_structure)
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_core/python/ops/control_flow_ops.py", line 2245, in BuildLoop
    pred, body, original_loop_vars, loop_vars, shape_invariants)
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_core/python/ops/control_flow_ops.py", line 2170, in _BuildLoop
    body_result = body(*packed_vars_for_body)
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_core/python/tpu/training_loop.py", line 121, in body_wrapper
    outputs = body(*(inputs + dequeue_ops))
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py", line 3588, in <lambda>
    lambda i, loss: [i + 1, single_tpu_train_step(i)],
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py", line 1715, in train_step
    self._call_model_fn(features, labels))
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py", line 1994, in _call_model_fn
    estimator_spec = self._model_fn(features=features, **kwargs)
  File "/home/htxu91/source/BERT/t2t_bert/pretrain_finetuning/classifier_fn_tpu_estimator.py", line 173, in model_fn
    use_tpu=opt_config.use_tpu)
  File "/home/htxu91/source/BERT/t2t_bert/optimizer/optimizer.py", line 128, in get_train_op
    grads = self.grad_clip_fn(loss, tvars, **kargs)
  File "/home/htxu91/source/BERT/t2t_bert/optimizer/optimizer.py", line 85, in grad_clip_fn
    grads = tf.gradients(loss, tvars)
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_core/python/ops/gradients_impl.py", line 158, in gradients
    unconnected_gradients)
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_core/python/ops/gradients_util.py", line 679, in _GradientsHelper
    lambda: grad_fn(op, *out_grads))
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_core/python/ops/gradients_util.py", line 350, in _MaybeCompile
    return grad_fn()  # Exit early
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_core/python/ops/gradients_util.py", line 679, in <lambda>
    lambda: grad_fn(op, *out_grads))
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_core/python/ops/math_grad.py", line 1482, in _SquaredDifferenceGrad
    gy = -array_ops.reshape(math_ops.reduce_sum(x_grad, ry), sy)
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_core/python/ops/array_ops.py", line 131, in reshape
    result = gen_array_ops.reshape(tensor, shape, name)
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_core/python/ops/gen_array_ops.py", line 8115, in reshape
    "Reshape", tensor=tensor, shape=shape, name=name)
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_core/python/framework/op_def_library.py", line 528, in _apply_op_helper
    preferred_dtype=default_dtype)
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_core/python/framework/ops.py", line 1285, in internal_convert_to_tensor
    value, dtype=preferred_dtype, name=name, as_ref=as_ref)
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_core/python/framework/constant_op.py", line 286, in _constant_tensor_conversion_function
    return constant(v, dtype=dtype, name=name)
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_core/python/framework/constant_op.py", line 227, in constant
    allow_broadcast=True)
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_core/python/framework/constant_op.py", line 271, in _constant_impl
    name=name).outputs[0]
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_core/python/util/deprecation.py", line 507, in new_func
    return func(*args, **kwargs)
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_core/python/framework/ops.py", line 3357, in create_op
    attrs, op_def, compute_device)
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_core/python/framework/ops.py", line 3426, in _create_op_internal
    op_def=op_def)
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_core/python/framework/ops.py", line 1789, in __init__
    self._control_flow_post_processing()
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_core/python/framework/ops.py", line 1800, in _control_flow_post_processing
    self._control_flow_context.AddOp(self)
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_core/python/ops/control_flow_ops.py", line 1716, in AddOp
    self._AddOpInternal(op)
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_core/python/ops/control_flow_ops.py", line 1733, in _AddOpInternal
    self._values.add(x.name)
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_core/python/framework/ops.py", line 416, in name
    if not self._op.name:
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_core/python/framework/ops.py", line 1879, in name
    return c_api.TF_OperationName(self._c_op)
KeyboardInterrupt
WARNING:tensorflow:From /home/htxu91/source/BERT/t2t_bert/optimizer/optimizer_utils.py:9: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.

WARNING:tensorflow:From /home/htxu91/source/BERT/t2t_bert/distributed_encoder/gpt_encoder.py:6: The name tf.AUTO_REUSE is deprecated. Please use tf.compat.v1.AUTO_REUSE instead.

WARNING:tensorflow:
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

WARNING:tensorflow:From /home/htxu91/source/BERT/t2t_bert/model_io/model_io_utils.py:14: The name tf.train.SessionRunHook is deprecated. Please use tf.estimator.SessionRunHook instead.

WARNING:tensorflow:From ./t2t_bert/distributed_bin/tpu_train_eval_api.py:342: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

I1030 05:50:52.636493 140471330162112 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1/rest
I1030 05:50:52.674588 140471330162112 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1/projects/albert-tpu-pretrain/locations/us-central1-a/nodes/htxu91?alt=json
I1030 05:50:52.674843 140471330162112 transport.py:157] Attempting refresh to obtain initial access_token
I1030 05:50:52.734662 140471330162112 discovery.py:271] URL being requested: GET https://www.googleapis.com/discovery/v1/apis/tpu/v1/rest
I1030 05:50:52.783229 140471330162112 discovery.py:867] URL being requested: GET https://tpu.googleapis.com/v1/projects/albert-tpu-pretrain/locations/us-central1-a/nodes/htxu91?alt=json
I1030 05:50:52.783477 140471330162112 transport.py:157] Attempting refresh to obtain initial access_token
('/home/htxu91/source/BERT', '==father path==')
['/home/htxu91/source/BERT/t2t_bert/distributed_bin', '/usr/lib/python2.7', '/usr/lib/python2.7/plat-x86_64-linux-gnu', '/usr/lib/python2.7/lib-tk', '/usr/lib/python2.7/lib-old', '/usr/lib/python2.7/lib-dynload', '/usr/local/lib/python2.7/dist-packages', '/usr/lib/python2.7/dist-packages', '/home/htxu91/source/BERT', '/home/htxu91/source/BERT/t2t_bert']
('gs://yyht_source/pretrain/', ['gs://yyht_source/pretrain/data/chunk_0.tfrecords', 'gs://yyht_source/pretrain/data/chunk_1.tfrecords', 'gs://yyht_source/pretrain/data/chunk_2.tfrecords', 'gs://yyht_source/pretrain/data/chunk_3.tfrecords', 'gs://yyht_source/pretrain/data/chunk_4.tfrecords', 'gs://yyht_source/pretrain/data/chunk_5.tfrecords', 'gs://yyht_source/pretrain/data/chunk_6.tfrecords', 'gs://yyht_source/pretrain/data/chunk_7.tfrecords', 'gs://yyht_source/pretrain/data/chunk_8.tfrecords', 'gs://yyht_source/pretrain/data/chunk_9.tfrecords', 'gs://yyht_source/pretrain/data/chunk_10.tfrecords', 'gs://yyht_source/pretrain/data/chunk_11.tfrecords', 'gs://yyht_source/pretrain/data/chunk_12.tfrecords', 'gs://yyht_source/pretrain/data/chunk_13.tfrecords', 'gs://yyht_source/pretrain/data/chunk_14.tfrecords', 'gs://yyht_source/pretrain/data/chunk_15.tfrecords', 'gs://yyht_source/pretrain/data/chunk_16.tfrecords', 'gs://yyht_source/pretrain/data/chunk_17.tfrecords'], ['gs://yyht_source/pretrain/data/chunk_18.tfrecords', 'gs://yyht_source/pretrain/data/chunk_19.tfrecords'], 'gs://yyht_source/pretrain/model/albert_tiny_factorized')
('###tpu_cluster_resolver:', <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fc1abb2ac10>, ';FLAGS.use_tpu:', True, ';FLAGS.tpu_name:', 'htxu91', ';FLAGS.tpu_zone:', None)

./t2t_bert/distributed_bin/tpu_train_eval_api.py:
  --batch_size: Input TF example files (can be a glob or comma separated).
    (default: '32')
    (an integer)
  --buckets: oss buckets
    (default: '')
  --char_limit: if apply distillation
    (default: '5')
    (an integer)
  --classifier: if apply distillation
    (default: 'order_classifier')
  --config_file: Input TF example files (can be a glob or comma separated).
  --decay: pretrained w2v
    (default: 'no')
  --dev_file: Input TF example files (can be a glob or comma separated).
  --distillation: if apply distillation
    (default: 'normal')
  --distillation_ratio: if apply distillation
    (default: '1.0')
    (a number)
  --distribution_strategy: distribution strategy
    (default: 'ParameterServerStrategy')
  --[no]do_eval: Whether to run eval on the dev set.
    (default: 'false')
  --[no]do_train: Whether to run training.
    (default: 'false')
  --epoch: Input TF example files (can be a glob or comma separated).
    (default: '5')
    (an integer)
  --eval_size: Input TF example files (can be a glob or comma separated).
    (default: '1000')
    (an integer)
  --gcp_project: [Optional] Project name for the Cloud TPU-enabled project. If
    not specified, we will attempt to automatically detect the GCE project from
    metadata.
  --if_shard: Input TF example files (can be a glob or comma separated).
  --init_checkpoint: Input TF example files (can be a glob or comma separated).
  --init_lr: if apply distillation
    (default: '5e-05')
    (a number)
  --input_target: the required num_gpus
    (default: '')
  --is_debug: Input TF example files (can be a glob or comma separated).
    (default: '0')
  --iterations_per_loop: How many steps to make in each estimator call.
    (default: '1000')
    (an integer)
  --label_id: Input TF example files (can be a glob or comma separated).
  --ln_type: if apply distillation
    (default: 'postln')
  --load_pretrained: the required num_gpus
    (default: 'no')
  --master: [Optional] TensorFlow master URL.
  --max_length: Input TF example files (can be a glob or comma separated).
    (default: '128')
    (an integer)
  --max_predictions_per_seq: if apply distillation
    (default: '10')
    (an integer)
  --mode: if apply distillation
    (default: 'single_task')
  --model_output: Input TF example files (can be a glob or comma separated).
  --model_type: Input TF example files (can be a glob or comma separated).
  --multi_task_config: if apply distillation
    (default: 'wsdm')
  --multi_task_type: if apply distillation
    (default: 'wsdm')
  --num_classes: Input TF example files (can be a glob or comma separated).
    (default: '5')
    (an integer)
  --num_gpus: the required num_gpus
    (default: '4')
    (an integer)
  --num_hidden_layers: if apply distillation
    (default: '12')
    (an integer)
  --num_tpu_cores: Only used if `use_tpu` is True. Total number of TPU cores to
    use.
    (default: '8')
    (an integer)
  --opt_type: Input TF example files (can be a glob or comma separated).
    (default: 'ps_sync')
  --output_layer: if apply distillation
    (default: 'interaction')
  --parse_type: the required num_gpus
    (default: 'parse_single')
  --profiler: the required num_gpus
    (default: 'normal')
  --rule_model: distribution strategy
    (default: 'normal')
  --run_type: Input TF example files (can be a glob or comma separated).
    (default: '0')
  --running_type: the required num_gpus
    (default: 'train')
  --save_checkpoints_steps: How often to save the model checkpoint.
    (default: '1000')
    (an integer)
  --task_type: if apply distillation
    (default: 'single_sentence_classification')
  --temperature: if apply distillation
    (default: '2.0')
    (a number)
  --tpu_name: The Cloud TPU to use for training. This should be either the name
    used when creating the Cloud TPU, or a grpc://ip.address.of.tpu:8470 url.
  --tpu_zone: [Optional] GCE zone where the Cloud TPU is located in. If not
    specified, we will attempt to automatically detect the GCE project from
    metadata.
  --train_file: Input TF example files (can be a glob or comma separated).
  --train_op: the required num_gpus
    (default: 'adam_decay')
  --train_size: Input TF example files (can be a glob or comma separated).
    (default: '1402171')
    (an integer)
  --[no]use_tpu: Whether to use TPU or GPU/CPU.
    (default: 'true')
  --vocab_file: Input TF example files (can be a glob or comma separated).
  --w2v_path: pretrained w2v
    (default: '')
  --warmup: pretrained w2v
    (default: 'no')
  --with_char: pretrained w2v
    (default: 'no_char')

absl.app:
  -?,--[no]help: show this help
    (default: 'false')
  --[no]helpfull: show full help
    (default: 'false')
  --[no]helpshort: show this help
    (default: 'false')
  --[no]helpxml: like --helpfull, but generates XML output
    (default: 'false')
  --[no]only_check_args: Set to true to validate args and exit.
    (default: 'false')
  --[no]pdb_post_mortem: Set to true to handle uncaught exceptions with PDB post
    mortem.
    (default: 'false')
  --profile_file: Dump profile information to a file (for python -m pstats).
    Implies --run_with_profiling.
  --[no]run_with_pdb: Set to true for PDB debug mode
    (default: 'false')
  --[no]run_with_profiling: Set to true for profiling the script. Execution will
    be slower, and the output format might change over time.
    (default: 'false')
  --[no]use_cprofile_for_profiling: Use cProfile instead of the profile module
    for profiling. This has no effect unless --run_with_profiling is set.
    (default: 'true')

absl.logging:
  --[no]alsologtostderr: also log to stderr?
    (default: 'false')
  --log_dir: directory to write logfiles into
    (default: '')
  --[no]logtostderr: Should only log to stderr?
    (default: 'false')
  --[no]showprefixforinfo: If False, do not prepend prefix to info messages when
    it's logged to stderr, --verbosity is set to INFO level, and python logging
    is used.
    (default: 'true')
  --stderrthreshold: log messages at this level, or more severe, to stderr in
    addition to the logfile.  Possible values are 'debug', 'info', 'warning',
    'error', and 'fatal'.  Obsoletes --alsologtostderr. Using --alsologtostderr
    cancels the effect of this flag. Please also note that this flag is subject
    to --verbosity and requires logfile not be stderr.
    (defauWARNING:tensorflow:From /home/htxu91/source/BERT/t2t_bert/pretrain_finetuning/train_eval_tpu_estimator.py:55: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

W1030 05:50:52.853415 140471330162112 module_wrapper.py:139] From /home/htxu91/source/BERT/t2t_bert/pretrain_finetuning/train_eval_tpu_estimator.py:55: The name tf.logging.info is deprecated. Please use tf.compat.v1.logging.info instead.

INFO:tensorflow:***** Running evaluation *****
I1030 05:50:52.853609 140471330162112 train_eval_tpu_estimator.py:55] ***** Running evaluation *****
INFO:tensorflow:***** train steps : 585900
I1030 05:50:52.853686 140471330162112 train_eval_tpu_estimator.py:56] ***** train steps : 585900
WARNING:tensorflow:Estimator's model_fn (<function model_fn at 0x7fc1abb22ed8>) includes params argument, but params are not passed to Estimator.
W1030 05:50:52.855870 140471330162112 estimator.py:1994] Estimator's model_fn (<function model_fn at 0x7fc1abb22ed8>) includes params argument, but params are not passed to Estimator.
INFO:tensorflow:Using config: {'_save_checkpoints_secs': None, '_session_config': allow_soft_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
isolate_session_state: true
, '_keep_checkpoint_max': 20, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fc1abb2af90>, '_model_dir': 'gs://yyht_source/pretrain/model/albert_tiny_factorized', '_protocol': None, '_save_checkpoints_steps': 1000, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=1000, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=3, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2, experimental_host_call_every_n_steps=1), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_session_creation_timeout_secs': 7200, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fc1abb2ac10>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
I1030 05:50:52.856951 140471330162112 estimator.py:212] Using config: {'_save_checkpoints_secs': None, '_session_config': allow_soft_placement: true
cluster_def {
  job {
    name: "worker"
    tasks {
      key: 0
      value: "10.240.1.2:8470"
    }
  }
}
isolate_session_state: true
, '_keep_checkpoint_max': 20, '_task_type': 'worker', '_train_distribute': None, '_is_chief': True, '_cluster_spec': <tensorflow.python.training.server_lib.ClusterSpec object at 0x7fc1abb2af90>, '_model_dir': 'gs://yyht_source/pretrain/model/albert_tiny_factorized', '_protocol': None, '_save_checkpoints_steps': 1000, '_keep_checkpoint_every_n_hours': 10000, '_service': None, '_num_ps_replicas': 0, '_tpu_config': TPUConfig(iterations_per_loop=1000, num_shards=8, num_cores_per_replica=None, per_host_input_for_training=3, tpu_job_name=None, initial_infeed_sleep_secs=None, input_partition_dims=None, eval_training_input_configuration=2, experimental_host_call_every_n_steps=1), '_tf_random_seed': None, '_save_summary_steps': 100, '_device_fn': None, '_session_creation_timeout_secs': 7200, '_cluster': <tensorflow.python.distribute.cluster_resolver.tpu_cluster_resolver.TPUClusterResolver object at 0x7fc1abb2ac10>, '_experimental_distribute': None, '_num_worker_replicas': 1, '_task_id': 0, '_log_step_count_steps': None, '_experimental_max_worker_delay_secs': None, '_evaluation_master': u'grpc://10.240.1.2:8470', '_eval_distribute': None, '_global_id_in_cluster': 0, '_master': u'grpc://10.240.1.2:8470'}
INFO:tensorflow:_TPUContext: eval_on_tpu True
I1030 05:50:52.857172 140471330162112 tpu_context.py:220] _TPUContext: eval_on_tpu True
INFO:tensorflow:***** Running training *****
I1030 05:50:52.857516 140471330162112 train_eval_tpu_estimator.py:100] ***** Running training *****
INFO:tensorflow:  Batch size = 1024
I1030 05:50:52.857604 140471330162112 train_eval_tpu_estimator.py:101]   Batch size = 1024
INFO:tensorflow:Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
I1030 05:50:53.657344 140471330162112 tpu_system_metadata.py:78] Querying Tensorflow master (grpc://10.240.1.2:8470) for TPU system metadata.
2019-10-30 05:50:53.658731: W tensorflow/core/distributed_runtime/rpc/grpc_session.cc:370] GrpcSession::ListDevices will initialize the session with an empty graph and other defaults because the session has not yet been created.
INFO:tensorflow:Found TPU system:
I1030 05:50:53.671021 140471330162112 tpu_system_metadata.py:148] Found TPU system:
INFO:tensorflow:*** Num TPU Cores: 8
I1030 05:50:53.671261 140471330162112 tpu_system_metadata.py:149] *** Num TPU Cores: 8
INFO:tensorflow:*** Num TPU Workers: 1
I1030 05:50:53.671353 140471330162112 tpu_system_metadata.py:150] *** Num TPU Workers: 1
INFO:tensorflow:*** Num TPU Cores Per Worker: 8
I1030 05:50:53.671421 140471330162112 tpu_system_metadata.py:152] *** Num TPU Cores Per Worker: 8
INFO:tensorflow:*** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 12182718136411149030)
I1030 05:50:53.671494 140471330162112 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:CPU:0, CPU, -1, 12182718136411149030)
INFO:tensorflow:*** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 14826215720572446469)
I1030 05:50:53.671957 140471330162112 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:0, TPU, 17179869184, 14826215720572446469)
INFO:tensorflow:*** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 1045945743155799162)
I1030 05:50:53.672035 140471330162112 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:1, TPU, 17179869184, 1045945743155799162)
INFO:tensorflow:*** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 12614746048098182569)
I1030 05:50:53.672103 140471330162112 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:2, TPU, 17179869184, 12614746048098182569)
INFO:tensorflow:*** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 16136986809138362557)
I1030 05:50:53.672171 140471330162112 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:3, TPU, 17179869184, 16136986809138362557)
INFO:tensorflow:*** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14868181460212679955)
I1030 05:50:53.672233 140471330162112 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:4, TPU, 17179869184, 14868181460212679955)
INFO:tensorflow:*** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 7363278423821274188)
I1030 05:50:53.672300 140471330162112 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:5, TPU, 17179869184, 7363278423821274188)
INFO:tensorflow:*** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 14953178981718906144)
I1030 05:50:53.672369 140471330162112 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:6, TPU, 17179869184, 14953178981718906144)
INFO:tensorflow:*** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 11404216267087989575)
I1030 05:50:53.672441 140471330162112 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU:7, TPU, 17179869184, 11404216267087989575)
INFO:tensorflow:*** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 13415030718927501820)
I1030 05:50:53.672506 140471330162112 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:TPU_SYSTEM:0, TPU_SYSTEM, 17179869184, 13415030718927501820)
INFO:tensorflow:*** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 9296447542546493800)
I1030 05:50:53.672566 140471330162112 tpu_system_metadata.py:154] *** Available Device: _DeviceAttributes(/job:worker/replica:0/task:0/device:XLA_CPU:0, XLA_CPU, 17179869184, 9296447542546493800)
WARNING:tensorflow:From /usr/local/lib/python2.7/dist-packages/tensorflow_core/python/ops/resource_variable_ops.py:1630: calling __init__ (from tensorflow.python.ops.resource_variable_ops) with constraint is deprecated and will be removed in a future version.
Instructions for updating:
If using Keras pass *_constraint arguments to layers.
W1030 05:50:53.679228 140471330162112 deprecation.py:506] From /usr/local/lib/python2.7/dist-packages/tensorflow_core/python/ops/resource_variable_ops.py:1630: calling __init__ (from tensorflow.python.ops.resource_variable_ops) with constraint is deprecated and will be removed in a future version.
Instructions for updating:
If using Keras pass *_constraint arguments to layers.
WARNING:tensorflow:From /usr/local/lib/python2.7/dist-packages/tensorflow_core/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
W1030 05:50:53.679765 140471330162112 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_core/python/training/training_util.py:236: initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
INFO:tensorflow:Calling model_fn.
I1030 05:50:53.691291 140471330162112 estimator.py:1148] Calling model_fn.
WARNING:tensorflow:From /home/htxu91/source/BERT/t2t_bert/data_generator/tf_data_utils.py:140: The name tf.FixedLenFeature is deprecated. Please use tf.io.FixedLenFeature instead.

W1030 05:50:53.692011 140471330162112 module_wrapper.py:139] From /home/htxu91/source/BERT/t2t_bert/data_generator/tf_data_utils.py:140: The name tf.FixedLenFeature is deprecated. Please use tf.io.FixedLenFeature instead.

WARNING:tensorflow:From /home/htxu91/source/BERT/t2t_bert/data_generator/tf_data_utils.py:171: parallel_interleave (from tensorflow.contrib.data.python.ops.interleave_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.data.experimental.parallel_interleave(...)`.
W1030 05:50:53.697509 140471330162112 deprecation.py:323] From /home/htxu91/source/BERT/t2t_bert/data_generator/tf_data_utils.py:171: parallel_interleave (from tensorflow.contrib.data.python.ops.interleave_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.data.experimental.parallel_interleave(...)`.
WARNING:tensorflow:From /usr/local/lib/python2.7/dist-packages/tensorflow_core/contrib/data/python/ops/interleave_ops.py:77: parallel_interleave (from tensorflow.python.data.experimental.ops.interleave_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.data.Dataset.interleave(map_func, cycle_length, block_length, num_parallel_calls=tf.data.experimental.AUTOTUNE)` instead. If sloppy execution is desired, use `tf.data.Options.experimental_determinstic`.
W1030 05:50:53.697690 140471330162112 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_core/contrib/data/python/ops/interleave_ops.py:77: parallel_interleave (from tensorflow.python.data.experimental.ops.interleave_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.data.Dataset.interleave(map_func, cycle_length, block_length, num_parallel_calls=tf.data.experimental.AUTOTUNE)` instead. If sloppy execution is desired, use `tf.data.Options.experimental_determinstic`.
WARNING:tensorflow:From /home/htxu91/source/BERT/t2t_bert/data_generator/tf_data_utils.py:188: map_and_batch (from tensorflow.contrib.data.python.ops.batching) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.data.experimental.map_and_batch(...)`.
W1030 05:50:53.721918 140471330162112 deprecation.py:323] From /home/htxu91/source/BERT/t2t_bert/data_generator/tf_data_utils.py:188: map_and_batch (from tensorflow.contrib.data.python.ops.batching) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.data.experimental.map_and_batch(...)`.
WARNING:tensorflow:From /usr/local/lib/python2.7/dist-packages/tensorflow_core/contrib/data/python/ops/batching.py:276: map_and_batch (from tensorflow.python.data.experimental.ops.batching) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.data.Dataset.map(map_func, num_parallel_calls)` followed by `tf.data.Dataset.batch(batch_size, drop_remainder)`. Static tf.data optimizations will take care of using the fused implementation.
W1030 05:50:53.722186 140471330162112 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_core/contrib/data/python/ops/batching.py:276: map_and_batch (from tensorflow.python.data.experimental.ops.batching) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.data.Dataset.map(map_func, num_parallel_calls)` followed by `tf.data.Dataset.batch(batch_size, drop_remainder)`. Static tf.data optimizations will take care of using the fused implementation.
WARNING:tensorflow:From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/api/_v1/estimator/__init__.py:12: The name tf.estimator.inputs is deprecated. Please use tf.compat.v1.estimator.inputs instead.

W1030 05:50:53.727926 140471330162112 module_wrapper.py:139] From /usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/api/_v1/estimator/__init__.py:12: The name tf.estimator.inputs is deprecated. Please use tf.compat.v1.estimator.inputs instead.

WARNING:tensorflow:From /usr/local/lib/python2.7/dist-packages/tensorflow_core/python/autograph/converters/directives.py:119: The name tf.parse_single_example is deprecated. Please use tf.io.parse_single_example instead.

W1030 05:50:53.786463 140471330162112 module_wrapper.py:139] From /usr/local/lib/python2.7/dist-packages/tensorflow_core/python/autograph/converters/directives.py:119: The name tf.parse_single_example is deprecated. Please use tf.io.parse_single_example instead.

WARNING:tensorflow:From /home/htxu91/source/BERT/t2t_bert/data_generator/tf_data_utils.py:43: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
W1030 05:50:53.901140 140471330162112 deprecation.py:323] From /home/htxu91/source/BERT/t2t_bert/data_generator/tf_data_utils.py:43: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
2019-10-30 05:50:53.959639: W tensorflow/stream_executor/platform/default/dso_loader.cc:55] Could not load dynamic library 'libcuda.so.1'; dlerror: libcuda.so.1: cannot open shared object file: No such file or directory
2019-10-30 05:50:53.959690: E tensorflow/stream_executor/cuda/cuda_driver.cc:318] failed call to cuInit: UNKNOWN ERROR (303)
2019-10-30 05:50:53.959718: I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:156] kernel driver does not appear to be running on this host (htxu91): /proc/driver/nvidia/version does not exist
INFO:tensorflow: begin to build bert
I1030 05:50:53.977011 140471330162112 albert.py:14]  begin to build bert
WARNING:tensorflow:From /home/htxu91/source/BERT/t2t_bert/model/bert/albert.py:22: The name tf.variable_scope is deprecated. Please use tf.compat.v1.variable_scope instead.

W1030 05:50:53.977286 140471330162112 module_wrapper.py:139] From /home/htxu91/source/BERT/t2t_bert/model/bert/albert.py:22: The name tf.variable_scope is deprecated. Please use tf.compat.v1.variable_scope instead.

WARNING:tensorflow:From /home/htxu91/source/BERT/t2t_bert/utils/bert/albert_modules.py:193: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

W1030 05:50:53.979151 140471330162112 module_wrapper.py:139] From /home/htxu91/source/BERT/t2t_bert/utils/bert/albert_modules.py:193: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

WARNING:tensorflow:From /home/htxu91/source/BERT/t2t_bert/utils/bert/albert_modules.py:89: calling dropout (from tensorflow.python.ops.nn_ops) with keep_prob is deprecated and will be removed in a future version.
Instructions for updating:
Please use `rate` instead of `keep_prob`. Rate should be set to `rate = 1 - keep_prob`.
W1030 05:50:54.046170 140471330162112 deprecation.py:506] From /home/htxu91/source/BERT/t2t_bert/utils/bert/albert_modules.py:89: calling dropout (from tensorflow.python.ops.nn_ops) with keep_prob is deprecated and will be removed in a future version.
Instructions for updating:
Please use `rate` instead of `keep_prob`. Rate should be set to `rate = 1 - keep_prob`.
WARNING:tensorflow:From /home/htxu91/source/BERT/t2t_bert/utils/bert/albert_modules.py:613: dense (from tensorflow.python.layers.core) is deprecated and will be removed in a future version.
Instructions for updating:
Use keras.layers.Dense instead.
W1030 05:50:54.064532 140471330162112 deprecation.py:323] From /home/htxu91/source/BERT/t2t_bert/utils/bert/albert_modules.py:613: dense (from tensorflow.python.layers.core) is deprecated and will be removed in a future version.
Instructions for updating:
Use keras.layers.Dense instead.
WARNING:tensorflow:From /usr/local/lib/python2.7/dist-packages/tensorflow_core/python/layers/core.py:187: apply (from tensorflow.python.keras.engine.base_layer) is deprecated and will be removed in a future version.
Instructions for updating:
Please use `layer.__call__` method instead.
W1030 05:50:54.065747 140471330162112 deprecation.py:323] From /usr/local/lib/python2.7/dist-packages/tensorflow_core/python/layers/core.py:187: apply (from tensorflow.python.keras.engine.base_layer) is deprecated and will be removed in a future version.
Instructions for updating:
Please use `layer.__call__` method instead.
WARNING:tensorflow:From /home/htxu91/source/BERT/t2t_bert/utils/bert/albert_modules.py:30: The name tf.erf is deprecated. Please use tf.math.erf instead.

W1030 05:50:54.213001 140471330162112 module_wrapper.py:139] From /home/htxu91/source/BERT/t2t_bert/utils/bert/albert_modules.py:30: The name tf.erf is deprecated. Please use tf.math.erf instead.

INFO:tensorflow:training_loop marked as finished
I1030 05:50:54.773511 140471330162112 error_handling.py:101] training_loop marked as finished
lt: 'fatal')
  -v,--verbosity: Logging verbosity level. Messages logged at this level or
    lower will be included. Set to 1 for debug logging. If the flag was not set
    or supplied, the value will be changed from the default of -1 (warning) to 0
    (info) after flags are parsed.
    (default: '-1')
    (an integer)

absl.testing.absltest:
  --test_random_seed: Random seed for testing. Some test frameworks may change
    the default value of this flag between runs, so it is not appropriate for
    seeding probabilistic tests.
    (default: '301')
    (an integer)
  --test_randomize_ordering_seed: If positive, use this as a seed to randomize
    the execution order for test cases. If "random", pick a random seed to use.
    If 0 or not set, do not randomize test case execution order. This flag also
    overrides the TEST_RANDOMIZE_ORDERING_SEED environment variable.
  --test_srcdir: Root of directory tree where source files live
    (default: '')
  --test_tmpdir: Directory for temporary testing files
    (default: '/tmp/absl_testing')
  --xml_output_file: File to store XML test results
    (default: '')

tensorflow.python.ops.parallel_for.pfor:
  --[no]op_conversion_fallback_to_while_loop: If true, falls back to using a
    while loop for ops for which a converter is not defined.
    (default: 'false')

absl.flags:
  --flagfile: Insert flag definitions from the given file into the command line.
    (default: '')
  --undefok: comma-separated list of flag names that it is okay to specify on
    the command line even if the program does not define a flag with that name.
    IMPORTANT: flags in this list that have arguments MUST use the --flag=value
    format.
    (default: '')
albert
({u'type_vocab_size': 2, u'pooler_num_fc_layers': 3, u'embedding_size': 128, u'num_attention_heads': 12, u'num_hidden_layers': 4, u'pooler_size_per_head': 128, u'vocab_size': 21128, u'attention_probs_dropout_prob': 0.1, u'directionality': u'bidi', u'pooler_type': u'first_token_transform', u'initializer_range': 0.02, u'max_position_embeddings': 512, u'embedding': u'factorized', u'hidden_act': u'gelu', u'shared_type': u'all', u'hidden_size': 312, u'intermediate_size': 1200, u'hidden_dropout_prob': 0.1, u'pooler_fc_size': 312, u'pooler_num_attention_heads': 12}, '==model config==')
('==apply bert pretrain==', 0.0001)
('==num warmup steps==', 58590)
 model type albert
(585900, 58590, '=============', 1, '==number of gpus==')
 initializing ModelIO 
embedding_lookup_factorized. factorized embedding parameterization is used.
('===number of hidden layers===', 4)
==apply post layer==
==apply albert masked lm==
Traceback (most recent call last):
  File "./t2t_bert/distributed_bin/tpu_train_eval_api.py", line 342, in <module>
    tf.app.run()
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_core/python/platform/app.py", line 40, in run
    _run(main=main, argv=argv, flags_parser=_parse_flags_tolerate_undef)
  File "/usr/local/lib/python2.7/dist-packages/absl/app.py", line 299, in run
    _run_main(main, args)
  File "/usr/local/lib/python2.7/dist-packages/absl/app.py", line 250, in _run_main
    sys.exit(main(argv))
  File "./t2t_bert/distributed_bin/tpu_train_eval_api.py", line 335, in main
    input_target=FLAGS.input_target)
  File "/home/htxu91/source/BERT/t2t_bert/pretrain_finetuning/train_eval_tpu_estimator.py", line 107, in train_eval_fn
    estimator.train(input_fn=input_features, max_steps=num_train_steps)
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py", line 3030, in train
    saving_listeners=saving_listeners)
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/estimator.py", line 370, in train
    loss = self._train_model(input_fn, hooks, saving_listeners)
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/estimator.py", line 1161, in _train_model
    return self._train_model_default(input_fn, hooks, saving_listeners)
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/estimator.py", line 1191, in _train_model_default
    features, labels, ModeKeys.TRAIN, self.config)
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py", line 2857, in _call_model_fn
    config)
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/estimator.py", line 1149, in _call_model_fn
    model_fn_results = self._model_fn(features=features, **kwargs)
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py", line 3159, in _model_fn
    _train_on_tpu_system(ctx, model_fn_wrapper, dequeue_fn))
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py", line 3604, in _train_on_tpu_system
    device_assignment=ctx.device_assignment)
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_core/python/tpu/tpu.py", line 1277, in split_compile_and_shard
    name=name)
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_core/python/tpu/tpu.py", line 992, in split_compile_and_replicate
    outputs = computation(*computation_inputs)
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py", line 3589, in multi_tpu_train_steps_on_single_shard
    inputs=[0, _INITIAL_LOSS])
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_core/python/tpu/training_loop.py", line 178, in while_loop
    condition_wrapper, body_wrapper, inputs, name="", parallel_iterations=1)
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_core/python/ops/control_flow_ops.py", line 2753, in while_loop
    return_same_structure)
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_core/python/ops/control_flow_ops.py", line 2245, in BuildLoop
    pred, body, original_loop_vars, loop_vars, shape_invariants)
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_core/python/ops/control_flow_ops.py", line 2170, in _BuildLoop
    body_result = body(*packed_vars_for_body)
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_core/python/tpu/training_loop.py", line 121, in body_wrapper
    outputs = body(*(inputs + dequeue_ops))
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py", line 3588, in <lambda>
    lambda i, loss: [i + 1, single_tpu_train_step(i)],
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py", line 1715, in train_step
    self._call_model_fn(features, labels))
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_estimator/python/estimator/tpu/tpu_estimator.py", line 1994, in _call_model_fn
    estimator_spec = self._model_fn(features=features, **kwargs)
  File "/home/htxu91/source/BERT/t2t_bert/pretrain_finetuning/classifier_fn_tpu_estimator.py", line 137, in model_fn
    embedding_projection=model.get_embedding_projection_table())
  File "/home/htxu91/source/BERT/t2t_bert/task_module/pretrain_albert.py", line 51, in get_masked_lm_output
    config.initializer_range))
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_core/python/util/deprecation.py", line 324, in new_func
    return func(*args, **kwargs)
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_core/python/layers/core.py", line 186, in dense
    _reuse=reuse)
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_core/python/layers/core.py", line 110, in __init__
    **kwargs)
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_core/python/keras/layers/core.py", line 988, in __init__
    activity_regularizer=regularizers.get(activity_regularizer), **kwargs)
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_core/python/layers/base.py", line 214, in __init__
    **kwargs)
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_core/python/training/tracking/base.py", line 457, in _method_wrapper
    result = method(self, *args, **kwargs)
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_core/python/keras/engine/base_layer.py", line 319, in __init__
    self._maybe_create_attribute('_non_trainable_weights', [])
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_core/python/keras/engine/base_layer.py", line 2210, in _maybe_create_attribute
    super(Layer, self).__setattr__(name, default_value)
  File "/usr/local/lib/python2.7/dist-packages/tensorflow_core/python/training/tracking/tracking.py", line 88, in __setattr__
    super(AutoTrackable, self).__setattr__(name, value)
KeyboardInterrupt
